#!/bin/bash

mypath=$(dirname $(readlink -f $(which "$0")))

args=("$@")
if [[ "${#args[@]}" -lt 2 ]]
then
   echo "Usage: Alien --<mode> AlienType:alienpkg [...]"
   echo
   echo "Valid options for <mode> are:"
   echo "    --get-version"
   echo "    --getinstallversion"
   echo "    --greater-than"
   echo "    --met|--within-range|--interval"
   echo "    --have-manager"
   echo "    --get-manager-rule"
   echo "    --install"
   echo
   echo "Valid options for AlienType are:"
   (
      cd "$mypath"
      for alien in Alien-*
      do
         echo "    ${alien#Alien-}"
      done
   )
   echo
   echo "Example:"
   echo "    Alien --install CPAN:XML::Parser"
   echo "    Alien --install PIP:burn"
   exit 1
fi

mode="$1"
prog="$2"
if [[ ! $prog =~ ^.+:.+$ ]] 
then
   echo "Error: missing program name, format shoud be 'AlienType:program'"
   exit 1
fi
alientype="${prog%%:*}"
alienpkg="${prog#*:}"
shift 2
if [[ ! -x /System/Index/bin/Alien-$alientype ]]
then
    echo "Error: $alientype is not a valid alientype"
    exit 1
fi
exec Alien-$alientype $mode $alienpkg "$@"
